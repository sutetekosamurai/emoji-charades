<link rel="stylesheet"
      href="{{ url_for('static', path='/css/result.css') }}?v={{ round.id if round else 0 }}">
{% extends "base.html" %}
{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', path='/css/result.css') }}?v={{ round.id if round else 0 }}">
{% endblock %}

{% block content %}
<div class="result-wrap">
  {% if wolf_won %}
    <div class="result-hero wolf">
      <div class="icon">ğŸº</div>
      <div>
        <div class="title">ã‚¦ãƒ«ãƒ•ã®å‹ã¡ï¼</div>
        <div class="sub">æ­£è§£è€… 0 åã€‚ã‚¦ãƒ«ãƒ•ã¯ <strong>{{ spy.name if spy else 'â€”' }}</strong>ã€‚</div>
      </div>
    </div>
  {% else %}
    <div class="result-hero citizen">
      <div class="icon">ğŸ‘¥</div>
      <div>
        <div class="title">å¸‚æ°‘ã®å‹ã¡ï¼</div>
        <div class="sub">æ­£è§£è€… {{ correct_voters|length }} åã€‚ã‚¦ãƒ«ãƒ•ã¯ <strong>{{ spy.name if spy else 'â€”' }}</strong>ã€‚</div>
      </div>
    </div>
  {% endif %}

  <section class="result-grid">
    {% for p in players %}
      {% set is_wolf = (spy and p.id == spy.id) %}
      <article class="card {% if is_wolf %}is-wolf{% endif %}">
        <header class="head">
          <div class="name">{{ p.name }}</div>
          <span class="role">{% if is_wolf %}ğŸº ã‚¦ãƒ«ãƒ•{% else %}ğŸ‘¥ å¸‚æ°‘{% endif %}</span>
        </header>

        <div class="stats">
          <div class="stat">
            <div class="label">ä»Šå›ã®å¾—ç¥¨</div>
            <div class="val">{{ tally.get(p.id, 0) }}</div>
          </div>
          <div class="stat">
            <div class="label">ç´¯è¨ˆã‚¹ã‚³ã‚¢</div>
            <div class="val">{{ p.score }}</div>
          </div>
        </div>

        {% if is_wolf and wolf_won %}
          <div class="delta">+3</div>
        {% elif correct_voters and (p.id in correct_voters) %}
          <div class="delta">+1</div>
        {% endif %}

        <div class="badges">
          {% if is_wolf and wolf_won %}<span class="tag">é€ƒã’åˆ‡ã‚Šãƒœãƒ¼ãƒŠã‚¹</span>{% endif %}
          {% if not is_wolf and correct_voters and (p.id in correct_voters) %}<span class="tag">æ­£è§£ï¼</span>{% endif %}
        </div>
      </article>
    {% endfor %}
  </section>

  <!-- ä»»æ„ï¼šæŠ•ç¥¨ä¸€è¦§ï¼ˆè¦‹ã‚„ã™ã„ã‚µãƒãƒªï¼‰ -->
  {% if vote %}
  <section class="table">
    <table>
      <thead><tr><th>æŠ•ç¥¨è€…</th><th>æŠ•ç¥¨å…ˆ</th></tr></thead>
      <tbody>
        {% for v in vote %}
          <tr>
            <td>{{ (players | selectattr('id','equalto', v.voter_id) | first).name }}</td>
            <td>{{ (players | selectattr('id','equalto', v.target_player_id) | first).name }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
  {% endif %}
</div>

{% endblock %}